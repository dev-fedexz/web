<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Killua Web | Official</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-bg: #050505;
            --panel-bg: rgba(20, 20, 20, 0.6);
            --text-dim: #b3b3b3;
            --accent: #1DB954; 
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at top right, rgba(29, 185, 84, 0.08), transparent);
            margin: 0; display: flex; flex-direction: column; align-items: center; color: white; padding-bottom: 60px; overflow-x: hidden;
        }

        #menuToggle { position: fixed; top: 25px; left: 25px; z-index: 100; cursor: pointer; background: var(--glass); backdrop-filter: blur(10px); padding: 12px; border-radius: 12px; border: 1px solid var(--border); }
        .sidebar { position: fixed; top: 0; left: -280px; width: 250px; height: 100%; background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(20px); transition: 0.5s; z-index: 99; padding: 40px 15px; border-right: 1px solid var(--border); }
        .sidebar.active { left: 0; }
        .sidebar a { padding: 15px 20px; text-decoration: none; font-size: 0.9rem; color: var(--text-dim); display: flex; align-items: center; gap: 15px; }

        .main-content { margin-top: 100px; width: 90%; max-width: 450px; text-align: center; }
        
        .hero-img { width: 100%; border-radius: 28px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .hero-img img { width: 100%; display: block; }

        h1 { font-size: 1.4rem; letter-spacing: 8px; margin: 40px 0; font-weight: 200; text-transform: uppercase; }

        .panel { background: var(--panel-bg); backdrop-filter: blur(10px); border-radius: 30px; padding: 20px; border: 1px solid var(--border); margin-bottom: 25px; }

        /* Aptoides */
        .api-card { background: rgba(255, 255, 255, 0.02); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 15px; text-align: left; }
        .api-name { font-weight: bold; font-size: 0.95rem; color: white; margin-bottom: 5px; display: block; }
        .api-desc { font-size: 0.75rem; color: var(--text-dim); margin-bottom: 12px; }
        
        .api-btn { background: var(--accent); color: black; padding: 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 800; border: none; cursor: pointer; width: 100%; transition: 0.3s; }
        .api-btn:hover { opacity: 0.8; transform: scale(0.98); }

        .tester-input {
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            padding: 12px; border-radius: 10px; color: white; font-size: 0.8rem; margin-bottom: 10px; box-sizing: border-box;
        }

        .json-response {
            background: #000; color: #00ff00; font-family: monospace; font-size: 0.7rem;
            padding: 10px; border-radius: 10px; max-height: 200px; overflow: auto; white-space: pre-wrap;
            border: 1px solid #111; margin-top: 10px; display: none;
        }

        .img-preview { width: 100%; border-radius: 10px; margin-top: 10px; display: none; border: 1px solid var(--border); }
        .category-title { font-size: 0.7rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin: 25px 0 10px; text-align: left; }

        .drop-zone { border: 2px dashed rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; cursor: pointer; color: var(--text-dim); display: block; }
        footer { margin-top: 50px; font-size: 0.6rem; opacity: 0.4; letter-spacing: 3px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 98; }
    </style>
</head>
<body>
    <div id="menuToggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
    <div class="sidebar" id="sidebar">
        <h2 style="font-size: 0.7rem; color:grey; text-align:center; margin-bottom: 20px;">KILLUA MENU</h2>
        <a href="https://whatsapp.com/channel/0029VbBG4i2GE56rSgXsqw2W" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
        <a href="https://github.com/the-xyzz" target="_blank"><i class="fab fa-github"></i> GitHub</a>
    </div>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="main-content">
        <div class="hero-img"><img src="https://raw.githubusercontent.com/the-xyzz/Killua/main/uploads/1769178219027.jpeg" alt="Hero"></div>
        <h1>Killua Web</h1>

        <div class="panel">
            <span style="font-weight: bold; display: block; margin-bottom: 15px;">Media Uploader</span>
            <label for="file-input" class="drop-zone"><i class="fas fa-cloud-upload-alt"></i> <br> <span id="file-name">Select File</span></label>
            <input type="file" id="file-input" onchange="updateFileName()" hidden>
            <button class="api-btn" onclick="processUpload()" style="margin-top:15px;">Upload To Server</button>
            <div id="up-res" style="display:none; margin-top:10px; font-size:0.75rem;">URL: <a href="#" id="up-link" style="color:var(--accent)" target="_blank"></a></div>
        </div>

        <div class="panel">
            <span style="font-weight: bold; display: block; margin-bottom: 20px;">Killua Aptoides</span>
            <div id="apis-container">Cargando módulos...</div>
        </div>
    </div>

    <footer>MADE BY THE-XYZZ</footer>

    <script>
        function toggleMenu() {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('overlay');
            sb.classList.toggle('active');
            ov.style.display = sb.classList.contains('active') ? 'block' : 'none';
        }

        function updateFileName() {
            const input = document.getElementById('file-input');
            if(input.files[0]) document.getElementById('file-name').innerText = input.files[0].name;
        }

        async function loadAptoides() {
            const container = document.getElementById('apis-container');
            try {
                const res = await fetch('/api/list');
                // Validar que la respuesta sea JSON real y no el HTML del error
                const text = await res.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch(e) {
                    throw new Error("El servidor envió HTML en lugar de JSON. Revisa tus rutas.");
                }

                let html = '';
                data.categories.forEach((cat, cIdx) => {
                    html += `<div class="category-title">${cat.name}</div>`;
                    cat.items.forEach((item, iIdx) => {
                        const id = `api-${cIdx}-${iIdx}`;
                        const isRandom = cat.name.toLowerCase().includes('random');
                        const isUrl = cat.name.toLowerCase().includes('downloader') || cat.name.toLowerCase().includes('tools');
                        
                        html += `
                        <div class="api-card">
                            <span class="api-name">${item.name}</span>
                            <p class="api-desc">${item.desc}</p>
                            ${!isRandom ? `<input type="text" id="input-${id}" class="tester-input" placeholder="${isUrl ? 'Pega el Link aquí...' : 'Escribe el texto aquí...'}">` : ''}
                            <button class="api-btn" onclick="runTest('${id}', '${item.path}', ${isRandom})">
                                ${isRandom ? 'Generar Imagen' : 'Ejecutar JSON'}
                            </button>
                            <img id="img-${id}" class="img-preview">
                            <pre id="res-${id}" class="json-response"></pre>
                        </div>`;
                    });
                });
                container.innerHTML = html;
            } catch (e) {
                container.innerHTML = `<p style="color:red; font-size:0.7rem;">${e.message}</p>`;
            }
        }

        async function runTest(id, path, isRandom) {
            const input = document.getElementById(`input-${id}`);
            const resBox = document.getElementById(`res-${id}`);
            const imgPrev = document.getElementById(`img-${id}`);
            const query = input ? input.value.trim() : '';

            resBox.style.display = "none";
            imgPrev.style.display = "none";

            let finalUrl = path;
            if (!isRandom && query) {
                if (path.includes('text=')) finalUrl = path.split('text=')[0] + `text=${encodeURIComponent(query)}`;
                else if (path.includes('url=')) finalUrl = path.split('url=')[0] + `url=${encodeURIComponent(query)}`;
                else if (path.includes('q=')) finalUrl = path.split('q=')[0] + `q=${encodeURIComponent(query)}`;
                else finalUrl += (finalUrl.includes('?') ? '&' : '?') + `query=${encodeURIComponent(query)}`;
            }

            try {
                const response = await fetch(finalUrl);
                const contentType = response.headers.get("content-type");

                if (contentType && contentType.includes("image")) {
                    imgPrev.src = finalUrl;
                    imgPrev.style.display = "block";
                } else {
                    const data = await response.json();
                    resBox.innerText = JSON.stringify(data, null, 2);
                    resBox.style.display = "block";
                }
            } catch (e) {
                resBox.innerText = "Error al ejecutar. Revisa los parámetros.";
                resBox.style.display = "block";
            }
        }

        async function processUpload() {
            const fileInput = document.getElementById('file-input');
            if (!fileInput.files[0]) return alert("Selecciona un archivo primero");
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            try {
                const res = await fetch('/upload-file', { method: 'POST', body: formData });
                const data = await res.json();
                if (data.url) {
                    document.getElementById('up-res').style.display = 'block';
                    document.getElementById('up-link').href = data.url;
                    document.getElementById('up-link').innerText = data.url;
                }
            } catch (e) { alert("Error al subir"); }
        }

        window.onload = loadAptoides;
    </script>
</body>
    </html>
